<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
<link rel="stylesheet" href="/styles/base.css">

    
<link rel="stylesheet" href="/styles/theme.css">

    <link rel="shortcut icon" href="/img/favicon.png">
    
    <title>Mac Pyhton3.7+Django2+Xadmin - WMYeah</title>
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-XXXXXXXXX');
    </script>
    
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="WMYeah" type="application/atom+xml">
</head>
<body>
    <div class="header-title">
        <span class="header-light"></span>
        <span class="header-light"></span>
        <span class="header-light"></span>
        <span>WMYeah www.wmyeah.com<span>
    </div>
    <div class="container">
        <ul class="nav">
        
            <li><a href="/">Main</a></li>
        
            <li><a href="/categories">Categories</a></li>
        
            <li><a href="/tags">Tags</a></li>
        
            <li><a href="/about">About</a></li>
        
        </ul>
        <div class="content">
            <div class="post-container">
    <div class="post-header">
        <span class="ui-tips">Title:</span>
        <h1 class="ui-keyword post-title">Mac Pyhton3.7+Django2+Xadmin</h1>
        <span class="post-date">2018-11-15</span>
    </div>
    
    
    <div class="post-header">
        <span class="ui-tips">Tag:</span>
        
        <a href="/tags/Linux/">Linux</a>
        
    </div>
    
    
    <div class="post-content"><p><font size=20>目录：</font></p>
<!-- TOC -->

<ul>
<li><a href="#1-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87">1. 环境准备</a><ul>
<li><a href="#11-python">1.1. Python</a></li>
<li><a href="#12-django2">1.2. Django2</a></li>
<li><a href="#13-xadmin">1.3. Xadmin</a></li>
<li><a href="#14-%E8%AE%BE%E7%BD%AE">1.4. 设置</a></li>
<li><a href="#15-%E6%97%B6%E5%8C%BA%E5%8F%8A%E6%9C%AC%E5%9C%B0%E6%98%BE%E7%A4%BA">1.5. 时区及本地显示</a></li>
<li><a href="#16-%E4%BE%9D%E8%B5%96%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86">1.6. 依赖文件处理</a></li>
<li><a href="#17-%E4%BF%AE%E6%94%B9%E6%9C%AC%E7%89%88%E6%9C%ACbug">1.7. 修改本版本Bug</a></li>
</ul>
</li>
<li><a href="#2-%E9%83%A8%E7%BD%B2centos7">2. 部署（CentOS7）</a></li>
<li><a href="#3-ps">3. PS:</a></li>
</ul>
<!-- /TOC -->

<h1 id="1-环境准备"><a href="#1-环境准备" class="headerlink" title="1. 环境准备"></a>1. 环境准备</h1><h2 id="1-1-Python"><a href="#1-1-Python" class="headerlink" title="1.1. Python"></a>1.1. Python</h2><ul>
<li>   此处使用Python3.7</li>
</ul>
<h2 id="1-2-Django2"><a href="#1-2-Django2" class="headerlink" title="1.2. Django2"></a>1.2. Django2</h2><ul>
<li>   本文使用Django2.1.3</li>
</ul>
<h2 id="1-3-Xadmin"><a href="#1-3-Xadmin" class="headerlink" title="1.3. Xadmin"></a>1.3. Xadmin</h2><ul>
<li><p>   Git远程源码安装（截止本文最新版本为2.0.1）</p>
   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install git+git://github.com/sshwsfc/xadmin.git@django2</span><br></pre></td></tr></table></figure>
</li>
<li><p>   卸载 xadmin并改用本地安装(主要是为了保留依赖环境)</p>
   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 uninstall xadmin</span><br></pre></td></tr></table></figure>
</li>
<li><p>   将自行下载的Xadmin拖入新建工程根目录</p>
</li>
<li><p>   新建apps（存放主App）</p>
</li>
<li><p>   新建extra_apps目录（存放 第三方App）</p>
</li>
<li><p>   将xamdin 目录从根目录下拖拽到extra_apps目录下（去掉下面的勾选）</p>
</li>
<li><p>   选中《extra_apps》目录 → 右键 → Mark Directory as → Sources Root</p>
</li>
<li><p>   注册 App 添加 xadmin、reversion</p>
   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    &#x27;django.contrib.admin&#x27;,</span><br><span class="line">    &#x27;django.contrib.auth&#x27;,</span><br><span class="line">    &#x27;django.contrib.contenttypes&#x27;,</span><br><span class="line">    &#x27;django.contrib.sessions&#x27;,</span><br><span class="line">    &#x27;django.contrib.messages&#x27;,</span><br><span class="line">    &#x27;django.contrib.staticfiles&#x27;,</span><br><span class="line">    &#x27;xadmin&#x27;,</span><br><span class="line">    &#x27;reversion&#x27;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><p>   说明</p>
   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1、以下设置可直接运行Xadmin自身进行测试</span><br><span class="line">2、主要是尽量不动第三方App的情况下自主开发自有管理系统,所以只需要依赖环境</span><br><span class="line">3、保留xadmin本地文件主要是为了更正xadmin中的bug，并且可以和其他小伙伴一起享用同一套代码</span><br><span class="line">4、所以本人将不会 对‘Xadmin’进行注册，而是注册依赖于Xadmin的自建App</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="1-4-设置"><a href="#1-4-设置" class="headerlink" title="1.4. 设置"></a>1.4. 设置</h2><ul>
<li><p>   使用PyCharm自带Terminal在工程根目录下进行操作</p>
</li>
<li><p>   更新</p>
   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./manage.py makemigrations</span><br></pre></td></tr></table></figure>
</li>
<li><p>   同步库表结构</p>
   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./manage.py migrate</span><br></pre></td></tr></table></figure>
</li>
<li><p>   创建超级管理员</p>
   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./manage.py createsuperuser</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="1-5-时区及本地显示"><a href="#1-5-时区及本地显示" class="headerlink" title="1.5. 时区及本地显示"></a>1.5. 时区及本地显示</h2><ul>
<li>   在settings.py中修改   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LANGUAGE_CODE = &#x27;zh-hans&#x27;</span><br><span class="line">TIME_ZONE = &#x27;Asia/Shanghai&#x27;</span><br><span class="line">USE_I18N = True</span><br><span class="line">USE_L10N = True</span><br><span class="line">USE_TZ = False</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="1-6-依赖文件处理"><a href="#1-6-依赖文件处理" class="headerlink" title="1.6. 依赖文件处理"></a>1.6. 依赖文件处理</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 依赖文件生成</span><br><span class="line">pip freeze &gt; requirements.txt</span><br><span class="line"># 依赖文件安装</span><br><span class="line">pip install -r requirement.txt</span><br></pre></td></tr></table></figure>

<h2 id="1-7-修改本版本Bug"><a href="#1-7-修改本版本Bug" class="headerlink" title="1.7. 修改本版本Bug"></a>1.7. 修改本版本Bug</h2><ul>
<li>.&#x2F;xadmin&#x2F;views&#x2F;dashboard.py 第36行进行修改  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 将如下代码</span><br><span class="line">def render(self, name, value, attrs=None):</span><br><span class="line">* 修改为</span><br><span class="line">def render(self, name, value, attrs=None, renderer=None):</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="2-部署（CentOS7）"><a href="#2-部署（CentOS7）" class="headerlink" title="2. 部署（CentOS7）"></a>2. 部署（CentOS7）</h1><ul>
<li><p>安装 virtualenv</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install virtualenv</span><br></pre></td></tr></table></figure>
</li>
<li><p>建立软链接</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/local/python3/bin/virtualenv /usr/bin/virtualenv</span><br></pre></td></tr></table></figure>
</li>
<li><p>   创建python_web虚拟环境</p>
   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virtualenv --python=/usr/bin/python3 python_web</span><br></pre></td></tr></table></figure>
</li>
<li><p>进入{python_web&#x2F;bin}目录，启动虚拟环境</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source activate</span><br></pre></td></tr></table></figure>
</li>
<li><p>在虚拟环境中使用pip3安django和uwsgi</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pip3 install django</span><br><span class="line">pip3 install uwsgi</span><br><span class="line"></span><br><span class="line">ln -s /usr/local/python3/bin/uwsgi /usr/bin/uwsgi		#建立uwsgi软链接以方便使用</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动项目(进入项目目录中)</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 manage.py runserver</span><br></pre></td></tr></table></figure>
</li>
<li><p>在项目根目录下配置UWSGI</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;uwsgi&gt;</span><br><span class="line">   &lt;socket&gt;127.0.0.1:8180&lt;/socket&gt; &lt;!-- 内部端口，自定义 --&gt;</span><br><span class="line">   &lt;chdir&gt;/home/mysite/&lt;/chdir&gt; &lt;!-- 项目路径 --&gt;</span><br><span class="line">   &lt;module&gt;mysite.wsgi&lt;/module&gt;  &lt;!-- mysite为wsgi.py所在目录名--&gt;</span><br><span class="line">   &lt;processes&gt;1&lt;/processes&gt; &lt;!-- 进程数 --&gt;</span><br><span class="line">   &lt;daemonize&gt;/home/logs/mysite.uwsgi.log&lt;/daemonize&gt; &lt;!-- 日志文件 --&gt;</span><br><span class="line">&lt;/uwsgi&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>   生成requirements.txt文件</p>
   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip freeze &gt; requirements.txt</span><br></pre></td></tr></table></figure>
</li>
<li><p>   安装requirements.txt依赖</p>
   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h1 id="3-PS"><a href="#3-PS" class="headerlink" title="3. PS:"></a>3. PS:</h1><ul>
<li>根据网上资料亲测整理，最终解释权归<a href="http://www.wmyeah.com/">WMYeah</a>所有!</li>
</ul>
<hr>
</div>
</div>

        </div>
        <div class="footer">
            
            <p class="footer-links">
            
                <a target="_blank" href="https://www.wmyeah.com">&copy; WMYeah</a>
            
            </p>
            
            <p class="footer-copyright">
                <span>Powered by <a target="_blank" href="https://hexo.io">Hexo</a></span>
                <span>Theme <a target="_blank" href="https://github.com/tinkink-co/hexo-theme-terminal">Terminal</a></span>
            </p>
        </div>
    </div>
</body>
</html>
